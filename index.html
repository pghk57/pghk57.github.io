<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>Ten Puzzle Solver (Wasm)</title>

  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    input {
      margin: 5px;
      width: 200px;
    }
    button {
      margin: 5px;
    }
    pre {
      margin-top: 15px;
      padding: 10px;
      background: #f5f5f5;
      border: 1px solid #ccc;
      max-height: 400px;
      overflow: auto;
    }
  </style>
</head>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-QH05YDGTKT"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-QH05YDGTKT');
</script>
  
<body>
  <h1>Ten Puzzle Solver</h1>

  <p>
    並べ替えを許可しないテンパズルの解を総当たりで探します<br>
    N <= 6までなら1秒程度で計算できます<br>
    (開発中)
  </p>

  <p>
    数列（空白区切り）：
    <input id="nums" placeholder="例: 1 8 9 5 8 9">
  </p>

  <p>
    target：
    <input id="target" placeholder="例: 10">
  </p>

  <button id="enumerate">enumerate</button>
  <button id="count">count</button>


  <pre id="out">ここに結果が表示されます</pre>

  <script src="tenpuzzle.js"></script>

  <script>
    let Module;
  
    createModule().then(m => {
      Module = m;
  
      const solveEnumerate = Module.cwrap(
        'solve_enumerate',
        'string',
        ['number','number','number']
      );
  
      const solveCount = Module.cwrap(
        'solve_count',
        'number',
        ['number','number','number']
      );
  
      function allocArray(nums) {
        const ptr = Module._malloc(nums.length * 4);
        Module.HEAP32.set(nums, ptr >> 2);
        return ptr;
      }
  
      document.getElementById("enumerate").onclick = () => {
        const nums = document.getElementById("nums").value
          .trim().split(/\s+/).map(Number);
        const target = Number(document.getElementById("target").value);
        const out = document.getElementById("out");
  
        const t0 = performance.now();
        const ptr = allocArray(nums);
        const res = solveEnumerate(nums.length, target, ptr);
        Module._free(ptr);
        const t1 = performance.now();
  
        out.textContent = res + `\nTime: ${(t1-t0).toFixed(2)} ms`;
      };
  
      document.getElementById("count").onclick = () => {
        const nums = document.getElementById("nums").value
          .trim().split(/\s+/).map(Number);
        const target = Number(document.getElementById("target").value);
        const out = document.getElementById("out");
  
        const t0 = performance.now();
        const ptr = allocArray(nums);
        const res = solveCount(nums.length, target, ptr);
        Module._free(ptr);
        const t1 = performance.now();
  
        out.textContent =
          `count = ${res}\nTime: ${(t1-t0).toFixed(2)} ms`;
      };
    });
  </script>

</body>
</html>
