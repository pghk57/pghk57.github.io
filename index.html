<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="utf-8">
  <title>Ten Puzzle Solver (Wasm)</title>

  <style>
    body {
      font-family: sans-serif;
      margin: 20px;
    }
    input {
      margin: 5px;
      width: 200px;
    }
    button {
      margin: 5px;
    }
    pre {
      margin-top: 15px;
      padding: 10px;
      background: #f5f5f5;
      border: 1px solid #ccc;
      max-height: 400px;
      overflow: auto;
    }
  </style>
</head>

<body>
  <h1>Ten Puzzle Solver</h1>

  <p>
    並べ替えを許可しないテンパズルの解を総当たりで探します<br>
    N <= 6までなら1秒程度で計算できます
  </p>

  <p>
    数列（空白区切り）：
    <input id="nums" placeholder="例: 1 8 9 5 8 9">
  </p>

  <p>
    target：
    <input id="target" placeholder="例: 10">
  </p>

  <button id="run">solve</button>

  <pre id="out">ここに結果が表示されます</pre>

  <!-- Emscriptenが生成したJS（中でWasmを読み込む） -->
  <script src="tenpuzzle.js"></script>

  <!-- ロジック部分 -->
  <script>
    Module.onRuntimeInitialized = () => {

      // C++関数 solve を JavaScript関数として包む
      const solve = Module.cwrap(
        'solve',     // C++側の関数名
        'string',    // 戻り値の型
        ['number', 'number', 'number'] // (N, target, int*)
      );

      document.getElementById("run").onclick = () => {
        const out = document.getElementById("out");
        out.textContent = "calculating…";

        // 入力取得
        const nums = document.getElementById("nums")
          .value.trim().split(/\s+/).map(Number);
        const target = Number(document.getElementById("target").value);
        out.textContent = "received input";

        if (nums.length === 0 || Number.isNaN(target)) {
          out.textContent = "入力が正しくありません";
          return;
        }

        out.textContent = "getting memory..."
        // Wasmメモリに配列を確保
        const ptr = Module._malloc(nums.length * Int32Array.BYTES_PER_ELEMENT);
        Module.HEAP32.set(nums, ptr / 4);

        out.textContent = "calling funciton..."
        // C++関数呼び出し
        const res = solve(nums.length, target, ptr);

        out.textContent = "completed calculation"
        // 後始末
        Module._free(ptr);

        // 結果表示
        out.textContent = res;
      };
    };
  </script>
</body>
</html>
